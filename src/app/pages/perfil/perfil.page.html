<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Perfil Estudiante</ion-title>
    <ion-buttons slot="end">
      <ion-chip color="medium" outline="true" class="user-chip" aria-label="Rol">
        <ion-icon name="person-circle-outline"></ion-icon>
        <ion-label>Estudiante</ion-label>
      </ion-chip>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="profile-shell">
    <div class="profile-card">

      <!-- Avatar + Nombre -->
      <div class="avatar-wrap">
        <ion-icon name="person-circle-outline" class="avatar-icon" aria-hidden="true"></ion-icon>
      </div>
      <h1 class="student-name">{{ profile.nombre || 'XXXX XXXX XXXX' }}</h1>

      <!-- Bloque de datos -->
      <div class="info-stack">
        <div class="info-chip"><b>RUT:</b> <span>{{ profile.rut || '12.345.678-9' }}</span></div>
        <div class="info-chip"><b>Carrera:</b> <em>{{ profile.carrera || 'Ingeniería en Informática' }}</em></div>
        <div class="info-chip"><b>Año ingreso:</b> <span>{{ profile.anioIngreso || '2023' }}</span></div>
        <div class="info-chip"><b>Celular:</b> <span>{{ profile.celular || '+56912345678' }}</span></div>
        <div class="info-chip"><b>Correo electrónico:</b> <span>{{ profile.email || 'xxxxxx@gmail.com' }}</span></div>
      </div>

      <!-- Botones -->
      <div class="actions">
        <ion-button class="flat-gray-btn" expand="block" (click)="openEdit()">
          Modificar datos
        </ion-button>
        <ion-button class="flat-gray-btn" fill="outline" expand="block" (click)="goBack()">
          Volver
        </ion-button>
      </div>
    </div>
  </div>

  <!-- ===== Modal de edición (corregido) ===== -->
  <ion-modal
    [isOpen]="editOpen"
    (didDismiss)="closeEdit()"
    class="edit-modal"
    [backdropDismiss]="true">
    <ng-template>
      <ion-header translucent="true">
        <ion-toolbar>
          <ion-title>Editar perfil</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEdit()" aria-label="Cerrar">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <!-- Quitar fullscreen evita conflictos con altura del modal -->
      <ion-content>
        <form [formGroup]="form" class="form-pad" (ngSubmit)="save()" autocomplete="off">

          <ion-item lines="full">
            <ion-label position="stacked">Nombre completo</ion-label>
            <ion-input formControlName="nombre" placeholder="Nombre Apellido"></ion-input>
          </ion-item>
          <ion-note color="danger" *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">
            Ingresa un nombre válido.
          </ion-note>

          <ion-item lines="full">
            <ion-label position="stacked">RUT</ion-label>
            <ion-input formControlName="rut" placeholder="12.345.678-9"></ion-input>
          </ion-item>

          <ion-item lines="full">
            <ion-label position="stacked">Carrera</ion-label>
            <ion-input formControlName="carrera" placeholder="Ingeniería en Informática"></ion-input>
          </ion-item>

          <ion-item lines="full">
            <ion-label position="stacked">Año ingreso</ion-label>
            <ion-input type="number" formControlName="anioIngreso" placeholder="2023"></ion-input>
          </ion-item>

          <ion-item lines="full">
            <ion-label position="stacked">Celular</ion-label>
            <ion-input formControlName="celular" placeholder="+56912345678"></ion-input>
          </ion-item>

          <ion-item lines="full">
            <ion-label position="stacked">Correo electrónico</ion-label>
            <ion-input type="email" formControlName="email" placeholder="nombre@dominio.com"></ion-input>
          </ion-item>
          <ion-note color="danger" *ngIf="form.get('email')?.invalid && form.get('email')?.touched">
            Ingresa un correo válido.
          </ion-note>

          <div class="modal-actions">
            <ion-button type="submit" [disabled]="form.invalid" class="flat-gray-btn" expand="block">
              Guardar cambios
            </ion-button>
            <ion-button fill="outline" expand="block" (click)="closeEdit()">Cancelar</ion-button>
          </div>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
